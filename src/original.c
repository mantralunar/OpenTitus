/*   
 * Copyright (C) 2008 - 2011 The OpenTitus team
 *
 * Authors:
 * Eirik Stople
 *
 * "Titus the Fox: To Marrakech and Back" (1992) and
 * "Lagaf': Les Aventures de Moktar - Vol 1: La Zoubida" (1991)
 * was developed by, and is probably copyrighted by Titus Software,
 * which, according to Wikipedia, stopped buisness in 2005.
 *
 * OpenTitus is not affiliated with Titus Software.
 *
 * OpenTitus is  free software; you can redistribute  it and/or modify
 * it under the  terms of the GNU General  Public License as published
 * by the Free  Software Foundation; either version 3  of the License,
 * or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT  ANY  WARRANTY;  without   even  the  implied  warranty  of
 * MERCHANTABILITY or  FITNESS FOR A PARTICULAR PURPOSE.   See the GNU
 * General Public License for more details.
 */

/* original.c
 * Contains data from the original game
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "SDL2/SDL.h"
#include "original.h"
#include "game.h"
#include <assert.h>

SDL_Color orig_palette_level_colour[16];

uint8_t spritewidth[SPRITECOUNT];
uint8_t spriteheight[SPRITECOUNT];
uint8_t spritecollwidth[SPRITECOUNT];
uint8_t spritecollheight[SPRITECOUNT];
uint8_t spriterefwidth[SPRITECOUNT];
uint8_t spriterefheight[SPRITECOUNT];

int16_t anim_player[ANIM_PLAYER_COUNT][ANIM_PLAYER_MAX];
// 21930 = turn invisible (set the invisible flag)
// negative number = walk that many animation frames back
// positive number = a mishmash of some flags and 0x1FFF masked sprite number to change the sprite to
// 8192 = 'trigger', which means 'shoot bullet using the next 2 animation frames for y position of the bullet and its sprite'
// there seem to be stretches of 3 adjacent values with this bit set
// but there are also single values ... maybe 'trigger' isn't always 'shoot'
int16_t anim_enemy[NMI_ANIM_TABLE_COUNT] = {
    53, 54, 55, 21930, -1,
    53, 54, 55, -3,
    141, -1,
    142, 142, 142, 143, 143, 143, 144, 144, 144, 145, 145, 145, -14,
    0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, -12,
    34, 34, 35, 35, 36, 36, -6,
    5, -1,
    6, 6, 6, 7, 7, 7, 8200, 8204, 8203, 8, 8, -13,
    16, -1,
    17, 17, 17, 18, 18, 18, 8211, 8206, 8217, 19, -12,
    44, -1,
    45, 45, 45, 46, 46, 46, 8239, 8203, 8203, 47, 47, -13,
    20, -1,
    21, 21, 21, 22, 22, 22, 23, 23, 23, 24, 24, 24, -14,
    30, 30, 30, 31, 31, 31, -6,
    32, -1,
    33, -1,
    25, 25, 25, 26, 26, 26, -6,
    27, 27, 27, 28, 28, 28, -6,
    25, 25, 25, 26, 26, 26, -6,
    48, -1,
    49, 49, 49, 49, 50, 50, 50, 51, 51, 51, 52, 52, 52, -9,
    50, 50, 50, 51, 51, 51, 52, 52, 8244, -11,
    58, -1,
    59, 59, 59, 60, 60, 60, 61, 61, 61, 62, 62, 62, -12,
    63, 63, 64, 64, 65, 8257, -8,
    56, 57, 21930, -1,
    56, 56, 56, 57, 57, 57, -6,
    67, 68, 21930, -1,
    67, 67, 67, 68, 68, 68, -6,
    71, -1,
    71, 71, 71, 72, 72, 72, -6,
    73, 73, 74, 74, 74, 75, 75, 75, 76, 76, 76, 77, 77, 77, 78, 78, 78, 77, 77, 77, 76, 76, 76, 75, 75, 75, 74, 74, 8266, -36,
    79, 79, 79, 80, 80, 80, 81, 81, 81, 82, 82, 82, 82, 82, 82, 82, 81, 81, 81, 80, 80, 80, 79, 79, 8271, -62,
    -63,
    -64,
    37, -1,
    38, -1,
    39, 39, 39, 40, 40, 40, 41, 41, 41, 42, 42, 42, 43, 43, 43, -12,
    84, 21930, -1,
    84, 84, 84, 85, 85, 85, 86, 86, 86, 87, 87, 87, 88, 88, 88, 89, 89, 89, 90, 90, 90, -12,
    87, 87, 8279, -13,
    131, 132, 133, 134, 130, -1,
    131, -1,
    132, 132, 133, 133, 134, 134, -6,
    126, -1,
    128, 128, 173, 173, 129, 129, -6,
    128, 128, 173, 173, 129, 8321, -8,
    127, 126, -1,
    127, -1,
    128, 128, 173, 173, 129, 129, -6,
    128, 128, 173, 173, 129, 129, -6,
    120, -1,
    120, 120, 120, 120, 121, 121, 121, 121, 122, 122, 122, 122, 123, 123, 123, 123, 124, 8316, 8205, 8192, 124, 124, -24,
    161, -1,
    9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, -12,
    15, 15, 15, 13, 13, 13, 8206, 8221, 8208, 14, 14, -24,
    103, 103, 103, 104, 104, 104, 105, 105, 105, -9,
    106, 106, 106, 107, 107, 107, 108, 108, 108, -9,
    171, 171, 172, 172, -4,
    113, -1,
    114, 114, 115, 115, 116, 116, 117, 117, 118, 118, -12,
    167, 167, 167, 167, 167, 167, 168, 168, 168, 168, 168, 168, 169, 169, 169, 169, 169, 169, 168, 168, 168, 168, 168, 168, -24,
    170, 170, 8362, 8205, 8212, 170, 170, -32,
    174, -1,
    175, 8367, 8260, 8204, 175, 175, -8,
    176, -1,
    177, 177, 8369, 8206, 8208, 177, 177, -9,
    178, 21930, -1,
    178, -1,
    179, 179, 179, 180, 180, 180, -6,
    180, -1,
    180, -1,
    188, 188, 188, 189, 189, 189, 190, 190, 190, 191, 191, 191, -12,
    192, 192, 192, 193, 193, 193, 194, 194, 194, 195, 195, 195, 196, 196, 196, -15,
    91, 91, 91, 93, 93, 93, -6,
    94, 94, 8286, 8222, 8200, 94, 94, 94, 94, 94, 94, 94, 94, 94, 94, 92, 92, 92, 92, 92, -23,
    211, -1,
    212, 212, 213, 213, 213, 214, 214, 214, 215, 215, 215, 216, 216, 216, -12,
    213, 213, 213, 214, 214, 214, 215, 215, 215, 216, 216, 8408, -14,
    69, 69, 69, 70, 70, 70, -6,
    69, 69, 69, 70, 70, 70, -6,
    69, 69, 69, 70, 70, 70, -6,
    109, 110, 111, -1,
    111, 111, 111, 110, 109, 109, 109, 8302, 8220, 8208, 110, 110, 111, 111, 111, 111, -18,
    223, -1,
    135, 135, 135, 136, 136, 136, 137, 137, 137, -9,
    8273, -8,
    138, 138, 138, 139, 139, 139, 140, 140, 140, 139, 139, 139, -12,
    8273, -7,
    181, 181, 181, 182, 182, 182, -6,
    8274, -7,
    224, -1,
    8271, -4,
    225, -1,
    8272, -4,
    226, -1,
    8251, -4,
    227, -1,
    217, 218, 219, 21930, -1,
    217, 217, 218, 218, 219, 219, -6,
    220, 221, 222, 21930, -1,
    220, 220, 221, 221, 222, 222, -6,
    208, 208, 208, 209, 209, 209, 210, 210, 210, -9,
    147, -1,
    148, 148, 148, 148, 149, 149, 149, 149, 149, 149, 8342, 8221, 8212, 150, 150, -17,
    156, -1,
    157, 157, 157, 157, 157, 158, 158, 158, 158, 158, 159, 159, 159, 8352, 8253, 8196, 160, 160, 160, 160, -22,
    183, 183, 183, -3,
    183, 183, 183, -3,
    184, 184, 184, 185, 185, 185, 186, 186, 186, 187, 187, 187, -12,
    162, -1,
    162, 162, 162, 163, 163, 163, 164, 164, 164, 165, 165, 165, -12,
    162, 162, 162, 163, 163, 163, 164, 164, 164, 165, 165, 165, 166, 166, 8358, -17,
    151, -1,
    152, 152, 152, 153, -1,
    154, -1,
    155, -1,
    228, -1,
    228, 228, 229, 229, -4,
    230, 230, 231, 231, 230, 8422, -8,
    99, 99, 99, 100, 100, 100, 101, 101, 101, -9,
    96, 96, 96, 97, 97, 97, 98, 98, 98, -9
};

void initoriginal() {
    int i, j;

    //anim_player --> ACTION
    int16_t orig_anim_player[ANIM_PLAYER_COUNT][ANIM_PLAYER_MAX] = {  {0,-2},
                                    {-1},
                                    {9,8,-4},
                                    {5,6,6,7,7,-8},
                                    {4,-2},
                                    {5,-2},
                                    {11,11,12,12,-8},
                                    {22,-2},
                                    {22,-2},
                                    {9,-2},
                                    {8,8,9,9,-8},
                                    {25,26,27,-6},
                                    {15,15,15,15,15,15,15,15,10,-2},
                                    {28,28,28,28,28,28,28,28,10,-2},
                                    {-1},
                                    {-1},
                                    {16,-2},
                                    {17,17,17,18,18,18,18,19,19,19,18,18,18,18,-28},
                                    {20,21,-4},
                                    {17,17,17,18,18,18,18,19,19,19,18,18,18,18,-28},
                                    {16,-2},
                                    {22,-2},
                                    {23,23,24,24,-8},
                                    {22,-2},
                                    {22,-2},
                                    {-1},
                                    {-1},
                                    {25,26,27,-6},
                                    {15,15,15,15,15,15,15,15,10,-2},
                                    {28,28,28,28,28,28,28,28,10,-2} };

    uint8_t spritewidth_titus[] = {32, 32, 24, 24, 32, 32, 32, 32, 32, 32, 24, 24, 24, 32, 32, 32, 24,
                                24, 24, 32, 24, 24, 24, 32, 32, 32, 32, 32, 32, 32, 24, 24, 16, 16,
                                24, 16, 16, 8, 16, 16, 16, 24, 16, 24, 8, 24, 16, 16, 16, 32, 48,
                                40, 40, 32, 16, 16, 40, 32, 24, 8, 16, 32, 24, 24, 32, 24, 32, 32,
                                16, 24, 16, 32, 32, 16, 16, 32, 32, 32, 32, 24, 16, 24, 32, 32, 40,
                                16, 16, 16, 16, 24, 16, 16, 32, 32, 32, 16, 32, 48, 16, 16, 16, 40,
                                32, 24, 32, 40, 48, 48, 48, 48, 32, 32, 24, 24, 40, 40, 40, 40, 40,
                                40, 40, 24, 24, 56, 32, 56, 24, 24, 24, 32, 24, 32, 32, 32, 40, 40,
                                40, 40, 32, 32, 40, 40, 32, 40, 32, 32, 32, 32, 40, 40, 40, 32, 24,
                                24, 24, 24, 24, 40, 32, 32, 32, 32, 32, 32, 56, 32, 40, 32, 16, 16,
                                16, 16, 32, 32, 32, 32, 32, 32, 32, 32, 40, 32, 40, 40, 40, 32, 32,
                                32, 32, 32, 32, 32, 32, 56, 32, 40, 48, 32, 32, 24, 32, 32, 32, 32,
                                40, 40, 40, 24, 24, 32, 32, 40, 32, 32, 24, 24, 24, 32, 40, 48, 48,
                                32, 32, 40, 40, 48, 40, 32, 32, 40, 40, 40, 32, 32, 40, 32, 24, 40,
                                32, 40, 40, 32, 16, 16, 24, 40, 40, 32, 40, 40, 64, 64, 64, 48, 48,
                                48, 48, 56, 48, 72, 48, 56, 24, 56, 56, 56, 56, 48, 32, 32, 32, 32,
                                48, 48, 40, 40, 40, 48, 56, 48, 16, 16, 40, 48, 40, 40, 40, 40, 40,
                                32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 24, 32, 24, 24, 40, 24, 32,
                                24, 24, 32, 40, 40, 40, 32, 40, 24, 24, 32, 24, 16, 16, 16, 24, 24,
                                24, 16, 24, 16, 8, 32, 56, 64, 88, 64, 64, 80, 72, 80, 32, 40, 40,
                                40, 40, 40, 32, 24, 32, 40, 16, 24, 24, 24, 32, 32, 40, 32, 16};

    uint8_t spriteheight_titus[] = {31, 32, 32, 32, 31, 26, 15, 16, 32, 32, 31, 32, 32, 29, 28, 32, 31,
                                 32, 32, 32, 31, 32, 29, 32, 32, 32, 32, 32, 32, 31, 30, 23, 16, 16,
                                 20, 16, 14, 16, 16, 15, 21, 10, 9, 4, 6, 17, 5, 7, 5, 9, 8,
                                 5, 5, 17, 11, 16, 32, 32, 12, 8, 9, 21, 11, 17, 16, 20, 25, 22,
                                 23, 17, 9, 13, 24, 11, 21, 19, 16, 15, 15, 30, 25, 21, 17, 22, 8,
                                 29, 8, 7, 7, 29, 9, 15, 9, 23, 8, 23, 21, 33, 12, 12, 13, 32,
                                 33, 32, 33, 30, 33, 33, 40, 33, 33, 32, 33, 32, 33, 33, 33, 31, 35,
                                 32, 40, 25, 27, 35, 61, 29, 19, 16, 20, 20, 20, 27, 28, 32, 32, 19,
                                 21, 19, 25, 25, 28, 36, 35, 36, 35, 32, 32, 40, 32, 16, 37, 30, 29,
                                 30, 18, 17, 19, 21, 21, 41, 42, 41, 41, 41, 41, 50, 40, 36, 15, 9,
                                 14, 11, 7, 9, 10, 18, 27, 27, 27, 27, 14, 22, 27, 33, 24, 18, 35,
                                 38, 37, 38, 37, 38, 31, 23, 31, 31, 28, 49, 49, 49, 34, 35, 35, 29,
                                 31, 33, 31, 33, 31, 33, 39, 26, 41, 34, 11, 16, 30, 32, 35, 28, 19,
                                 11, 26, 26, 35, 26, 27, 17, 17, 26, 25, 20, 26, 26, 26, 26, 39, 38,
                                 38, 37, 37, 37, 24, 40, 30, 38, 30, 24, 50, 54, 59, 49, 55, 50, 61,
                                 48, 42, 52, 46, 47, 52, 52, 33, 61, 59, 60, 60, 58, 35, 35, 35, 39,
                                 45, 43, 23, 40, 41, 40, 52, 31, 16, 16, 51, 53, 55, 55, 56, 55, 56,
                                 39, 36, 38, 38, 37, 38, 38, 39, 36, 54, 54, 53, 54, 53, 32, 32, 31,
                                 32, 31, 27, 37, 38, 38, 15, 49, 38, 41, 37, 41, 15, 16, 16, 21, 24,
                                 21, 21, 30, 25, 9, 21, 101, 99, 78, 69, 45, 41, 55, 41, 33, 30, 33,
                                 35, 34, 33, 34, 34, 34, 34, 10, 14, 19, 24, 26, 28, 32, 33, 9};

    uint8_t spritewidth_moktar[] = {24, 32, 24, 32, 32, 32, 32, 32, 32, 32, 32, 24, 24, 32, 32, 32, 24,
                                 32, 24, 32, 24, 24, 32, 32, 32, 40, 40, 40, 32, 48, 24, 24, 16, 16,
                                 24, 16, 16, 8, 16, 16, 16, 24, 16, 24, 8, 24, 16, 16, 16, 32, 48,
                                 40, 40, 32, 16, 16, 40, 32, 24, 8, 16, 32, 24, 24, 32, 24, 32, 32,
                                 16, 24, 16, 32, 32, 16, 16, 32, 32, 32, 32, 24, 16, 24, 32, 32, 40,
                                 16, 16, 16, 16, 24, 16, 16, 32, 32, 32, 16, 32, 48, 16, 16, 16, 40,
                                 32, 24, 32, 40, 48, 48, 48, 48, 32, 32, 24, 24, 40, 40, 40, 40, 40,
                                 40, 40, 24, 24, 56, 32, 56, 24, 24, 24, 32, 24, 32, 32, 32, 40, 40,
                                 40, 40, 32, 32, 40, 40, 32, 40, 32, 32, 32, 32, 40, 40, 40, 32, 24,
                                 24, 24, 24, 24, 40, 32, 32, 32, 32, 32, 32, 56, 32, 40, 32, 16, 16,
                                 16, 16, 32, 32, 32, 32, 32, 32, 32, 32, 40, 32, 40, 40, 40, 32, 32,
                                 32, 32, 32, 32, 32, 32, 56, 32, 40, 48, 32, 32, 24, 32, 32, 32, 32,
                                 40, 40, 40, 24, 24, 32, 32, 40, 32, 32, 24, 24, 24, 32, 40, 48, 48,
                                 32, 32, 40, 40, 48, 40, 32, 32, 40, 40, 40, 32, 32, 40, 32, 24, 40,
                                 32, 40, 40, 32, 16, 16, 24, 40, 40, 32, 40, 40, 64, 64, 64, 48, 48,
                                 48, 48, 56, 48, 72, 48, 56, 24, 56, 56, 56, 56, 48, 32, 32, 32, 32,
                                 48, 48, 40, 40, 40, 48, 56, 48, 16, 16, 40, 48, 40, 40, 40, 40, 40,
                                 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 24, 32, 24, 24, 40, 24, 32,
                                 24, 24, 32, 40, 40, 40, 32, 40, 24, 24, 32, 24, 16, 16, 16, 24, 24,
                                 24, 16, 24, 16, 8, 32, 56, 64, 88, 64, 64, 80, 72, 80, 32, 40, 48,
                                 40, 40, 40, 32, 32, 40, 40, 16, 24, 24, 24, 32, 32, 40, 32, 16};

    uint8_t spriteheight_moktar[] = {32, 31, 30, 31, 31, 21, 16, 16, 32, 32, 29, 32, 32, 28, 24, 32, 32,
                                  32, 32, 32, 32, 32, 27, 32, 32, 34, 32, 32, 33, 33, 30, 23, 16, 16,
                                  20, 16, 14, 16, 16, 15, 21, 10, 9, 4, 6, 17, 5, 7, 5, 9, 8,
                                  5, 5, 17, 11, 16, 32, 32, 12, 8, 9, 21, 11, 17, 16, 20, 25, 22,
                                  23, 17, 9, 13, 24, 11, 21, 19, 16, 15, 15, 30, 25, 21, 17, 22, 8,
                                  29, 8, 7, 7, 29, 9, 15, 9, 23, 8, 23, 21, 33, 12, 12, 13, 32,
                                  33, 32, 33, 30, 33, 33, 40, 33, 33, 32, 33, 32, 33, 33, 33, 31, 35,
                                  32, 40, 25, 27, 35, 61, 29, 19, 16, 20, 20, 20, 27, 28, 32, 32, 19,
                                  21, 19, 27, 27, 31, 32, 31, 34, 31, 32, 32, 40, 32, 16, 37, 30, 29,
                                  30, 18, 17, 19, 21, 21, 41, 42, 41, 41, 41, 41, 50, 41, 36, 15, 9,
                                  14, 11, 7, 9, 10, 18, 27, 27, 27, 27, 14, 22, 27, 33, 24, 18, 35,
                                  38, 37, 38, 37, 38, 31, 23, 31, 31, 28, 49, 49, 49, 34, 35, 35, 29,
                                  31, 33, 31, 33, 31, 33, 39, 26, 41, 34, 11, 16, 30, 32, 35, 28, 19,
                                  11, 26, 26, 35, 26, 27, 17, 17, 26, 25, 20, 26, 26, 26, 26, 39, 38,
                                  38, 37, 37, 37, 24, 40, 30, 38, 30, 24, 50, 54, 59, 49, 55, 50, 61,
                                  48, 42, 52, 46, 47, 52, 52, 33, 61, 59, 60, 60, 58, 35, 35, 35, 39,
                                  45, 43, 23, 40, 41, 40, 52, 31, 16, 16, 51, 53, 55, 55, 56, 55, 56,
                                  39, 36, 38, 38, 37, 38, 38, 39, 36, 54, 54, 53, 54, 53, 32, 32, 31,
                                  32, 31, 27, 37, 38, 38, 15, 49, 38, 41, 37, 41, 15, 16, 16, 21, 24,
                                  21, 21, 30, 25, 9, 21, 101, 99, 78, 69, 45, 41, 55, 41, 33, 30, 33,
                                  35, 34, 33, 29, 30, 30, 31, 10, 14, 19, 24, 26, 28, 32, 33, 9};


    uint8_t tmpspritecoll_titus[] = { 28,31,29,32,27,32,28,32,30,31,30,26,31,15,31,16,30,32,29,32,27,31,28,32,27,32,31,29,29,28,30,32,28,31,28,32,27,32,28,32,28,31,27,32,27,29,29,32,29,32,31,32,31,32,31,32,30,32,29,31,
                                    27,30,26,23,16,16,16,16,25,20,15,16,12,14,11,16,16,16,15,15,13,21,26,10,15,9,28,4,11,6,25,17,12,5,13,7,14,5,29,9,46,8,44,5,43,5,28,17,16,11,16,16,44,32,30,32,25,12,12,8,13,9,29,21,27,11,20,17,32,16,27,20,29,25,29,22,12,
                                    23,28,17,16,9,30,13,30,24,13,11,13,21,31,19,29,16,29,15,31,15,20,30,16,25,28,21,28,17,29,22,41,8,14,29,16,8,15,7,15,7,25,29,16,9,15,15,32,9,28,23,31,8,15,23,29,21,47,33,14,12,14,12,14,13,
                                    42,32,30,33,28,32,29,33,36,30,45,33,45,33,44,40,48,33,28,33,29,32,27,33,26,32,41,33,42,33,42,33,41,31,41,35,43,32,41,40,26,25,27,27,59,35,30,61,59,29,27,19,27,16,26,20,28,20,28,20,31,27,30,28,32,32,36,32,
                                    41,19,41,21,41,19,29,25,29,25,43,28,36,36,32,35,36,36,32,35,29,32,29,32,30,40,36,32,36,16,43,37,29,30,27,29,26,30,25,18,26,17,25,19,43,21,30,21,29,41,29,42,29,41,31,41,29,41,59,41,28,50,41,40,29,36,15,15,16,9,15,14,16,11,
                                    31,7,29,9,30,10,31,18,31,27,31,27,31,27,31,27,36,14,32,22,41,27,42,33,44,24,28,18,31,35,31,38,31,37,31,38,31,37,31,38,32,31,58,23,31,31,36,31,47,28,28,49,29,49,27,49,28,34,29,35,28,35,29,29,43,31,42,33,42,31,27,33,26,31,
                                    28,33,30,39,41,26,32,41,31,34,27,11,27,16,27,30,29,32,44,35,45,28,47,19,29,11,31,26,43,26,43,35,47,26,36,27,
                                    28,17,28,17,42,26,42,25,36,20,31,26,31,26,41,26,31,26,27,39,43,38,29,38,36,37,43,37,32,37,16,24,16,40,28,30,43,38,42,30,32,24,43,50,41,54,63,59,63,49,62,55,45,50,45,61,47,48,47,42,
                                    58,52,46,46,73,47,44,52,57,52,28,33,57,61,57,59,57,60,57,60,46,58,31,35,31,35,31,35,31,39,47,45,47,43,41,23,41,40,41,41,48,40,58,52,48,31,16,16,15,16,44,51,46,53,
                                    44,55,43,55,44,56,43,55,43,56,29,39,29,36,29,38,29,38,32,37,32,38,32,38,32,39,32,36,28,54,28,54,29,53,27,54,27,53,36,32,28,32,29,31,27,32,26,31,28,27,43,37,43,38,42,38,29,15,44,49,27,38,27,41,29,37,27,41,15,15,16,16,15,16,
                                    28,21,26,24,28,21,13,21,20,30,16,25,12,9,29,21,
                                    60,101,62,99,84,78,63,69,64,45,77,41,73,55,77,41,29,33,42,30,44,33,41,35,43,34,42,33,30,34,28,34,29,34,36,34,13,10,20,14,26,19,27,24,29,26,31,28,36,32,32,33,13,9};

    uint8_t tmpspritecoll_moktar[] = {  16,32,30,31,26,30,30,31,31,31,31,21,31,16,31,16,31,32,16,32,29,29,27,32,27,32,32,28,29,24,31,32,27,32,28,32,26,32,30,32,27,32,26,32,31,27,31,32,30,32,36,34,36,32,36,32,31,33,45,33,
                                    27,30,26,23,16,16,16,16,25,20,15,16,12,14,11,16,16,16,15,15,13,21,26,10,15,9,28,4,11,6,25,17,12,5,13,7,14,5,29,9,46,8,44,5,43,5,28,17,16,11,16,16,44,32,30,32,25,12,12,8,13,9,29,21,27,11,20,17,32,16,27,20,29,25,29,22,12,23,
                                    28,17,16,9,30,13,30,24,13,11,13,21,31,19,29,16,29,15,31,15,20,30,16,25,28,21,28,17,29,22,41,8,14,29,16,8,15,7,15,7,25,29,16,9,15,15,32,9,28,23,31,8,15,23,29,21,47,33,14,12,14,12,14,13,
                                    42,32,30,33,28,32,29,33,36,30,45,33,45,33,44,40,48,33,28,33,29,32,27,33,26,32,41,33,42,33,42,33,41,31,41,35,43,32,41,40,26,25,27,27,59,35,30,61,59,29,27,19,27,16,26,20,28,20,28,20,31,27,30,28,32,32,36,32,
                                    41,19,41,21,41,19,29,27,29,27,44,31,41,32,32,31,41,34,32,31,29,32,29,32,30,40,36,32,36,16,43,37,29,30,27,29,26,30,25,18,26,17,25,19,43,21,30,21,29,41,29,42,29,41,31,41,29,41,59,41,28,50,41,41,29,36,15,15,16,9,15,14,16,11,
                                    31,7,29,9,30,10,31,18,31,27,31,27,31,27,31,27,36,14,32,22,41,27,42,33,44,24,28,18,31,35,31,38,31,37,31,38,31,37,31,38,32,31,58,23,31,31,36,31,47,28,28,49,29,49,27,49,28,34,29,35,28,35,29,29,43,31,42,33,42,31,27,33,26,31,
                                    28,33,30,39,41,26,32,41,31,34,27,11,27,16,27,30,29,32,44,35,45,28,47,19,29,11,31,26,43,26,43,35,47,26,36,27,
                                    28,17,28,17,42,26,42,25,36,20,31,26,31,26,41,26,31,26,27,39,43,38,29,38,36,37,43,37,32,37,16,24,16,40,28,30,43,38,42,30,32,24,43,50,41,54,63,59,63,49,62,55,45,50,45,61,47,48,47,42,
                                    58,52,46,46,73,47,44,52,57,52,28,33,57,61,57,59,57,60,57,60,46,58,31,35,31,35,31,35,31,39,47,45,47,43,41,23,41,40,41,41,48,40,58,52,48,31,16,16,15,16,44,51,46,53,
                                    44,55,43,55,44,56,43,55,43,56,29,39,29,36,29,38,29,38,32,37,32,38,32,38,32,39,32,36,28,54,28,54,29,53,27,54,27,53,36,32,28,32,29,31,27,32,26,31,28,27,43,37,43,38,42,38,29,15,44,49,27,38,27,41,29,37,27,41,15,15,16,16,15,16,
                                    28,21,26,24,28,21,13,21,20,30,16,25,12,9,29,21,
                                    60,101,62,99,84,78,63,69,64,45,77,41,73,55,77,41,29,33,42,30,44,33,41,35,43,34,42,33,31,29,31,30,36,30,41,31,13,10,20,14,26,19,27,24,29,26,31,28,36,32,32,33,13,9};

    uint8_t tmpspriteref_titus[] = { 16,31,16,32,9,32,7,32,16,31,16,26,16,15,16,16,16,32,16,32,12,31,12,32,12,32,16,29,16,28,16,32,9,31,9,32,9,32,12,32,9,31,8,32,12,29,16,32,16,32,16,32,16,32,16,32,16,32,16,31,
                                    12,30,12,23,8,16,8,16,12,20,8,16,8,14,4,16,8,16,8,15,8,21,12,10,8,9,12,4,4,6,12,17,8,5,8,7,8,5,16,9,24,8,20,5,20,5,16,17,8,11,8,16,20,32,15,32,12,12,4,8,8,9,16,21,12,11,12,17,
                                    16,16,12,20,16,25,16,22,8,23,12,17,8,9,16,13,16,24,8,11,8,21,16,19,16,16,16,15,16,15,12,30,8,25,12,21,16,17,16,22,20,8,8,29,8,8,8,7,8,7,12,29,0,0,8,15,0,0,16,23,16,8,8,23,16,21,24,33,8,12,8,12,8,13,
                                    20,32,16,33,12,32,16,33,20,30,24,33,24,33,24,40,24,33,16,33,16,32,12,33,12,32,20,33,20,33,20,33,20,31,20,35,20,32,20,40,12,25,12,27,28,35,16,61,28,29,12,19,12,16,12,20,16,20,12,20,16,27,16,28,16,32,20,32,
                                    20,19,20,21,20,19,16,27,16,27,20,30,20,36,16,35,20,36,16,35,16,32,16,32,16,40,20,32,20,16,20,37,16,30,12,29,12,30,12,18,12,17,12,19,20,21,16,21,16,41,16,42,16,41,16,41,16,41,28,41,16,50,20,41,16,36,8,15,8,9,8,14,8,11,
                                    16,7,16,9,16,10,16,18,16,27,16,27,16,27,16,27,20,14,16,22,20,27,20,33,20,24,16,18,16,35,16,38,16,37,16,38,16,37,16,38,31,26,53,16,30,26,35,26,46,9,16,49,16,49,12,49,16,34,16,35,16,35,16,29,20,31,20,33,20,31,12,33,12,31,
                                    16,33,17,38,28,25,21,25,23,23,11,10,11,15,11,29,17,31,28,34,33,27,33,16,16,10,18,24,23,24,15,33,32,24,27,18,
                                    16,17,16,17,20,26,20,25,20,20,16,26,16,26,20,26,16,26,12,39,20,38,16,38,20,37,20,37,16,37,7,23,7,39,15,29,29,37,29,29,16,23,20,50,20,54,32,59,32,49,32,55,24,50,24,61,24,48,24,42,
                                    28,52,24,46,36,47,24,52,28,52,12,33,28,61,28,59,28,60,28,60,24,58,15,34,15,35,15,36,15,39,24,45,24,43,20,23,20,40,20,41,24,39,31,51,24,31,7,15,8,15,20,51,24,53,
                                    20,55,20,55,20,56,20,55,20,56,16,39,16,36,16,38,16,38,16,37,16,38,16,38,16,39,16,36,16,54,12,54,16,53,12,54,12,53,20,32,12,32,16,31,12,32,12,31,16,27,20,37,20,38,20,38,16,15,20,49,12,38,12,41,16,37,12,41,8,15,8,16,8,16,
                                    12,21,12,24,12,21,8,21,12,30,8,25,4,9,16,21,
                                    28,101,32,99,63,78,44,69,32,45,40,41,36,55,40,41,16,33,20,30,20,33,20,35,20,34,20,33,16,34,12,34,16,34,20,34,8,10,12,14,12,19,12,24,16,26,16,28,20,32,16,33,8,9};

    uint8_t tmpspriteref_moktar[] = {  12,32,16,31,12,30,16,31,16,31,16,21,16,16,16,16,16,32,16,32,16,29,12,32,12,32,16,28,16,24,16,32,12,32,16,32,12,32,16,32,12,32,12,32,16,27,16,32,16,32,20,34,20,32,20,32,16,33,24,33,
                                    12,30,12,23,8,16,8,16,12,20,8,16,8,14,4,16,8,16,8,15,8,21,12,10,8,9,12,4,4,6,12,17,8,5,8,7,8,5,16,9,24,8,20,5,20,5,16,17,8,11,8,16,21,32,16,32,12,12,4,8,8,9,16,21,12,11,12,17,16,
                                    16,12,20,16,25,16,22,8,23,12,17,8,9,16,13,16,24,8,11,8,21,16,19,16,16,16,15,16,15,12,30,8,25,12,21,16,17,16,22,20,8,8,29,8,8,8,7,8,7,12,29,0,0,8,15,0,0,16,23,16,8,8,23,16,21,24,33,8,12,8,12,8,13,
                                    20,32,16,33,12,32,16,33,20,30,24,33,24,33,24,40,24,33,16,33,16,32,12,33,12,32,20,33,20,33,20,33,20,31,20,35,20,32,20,40,11,24,11,26,10,34,18,60,43,26,12,19,12,16,12,20,16,20,12,20,16,26,18,26,18,31,23,25,
                                    20,19,20,21,20,19,16,27,16,27,20,31,20,32,16,31,20,34,16,31,16,32,16,32,16,40,20,32,20,16,20,37,16,30,12,29,12,30,12,18,12,17,12,19,20,21,16,21,16,41,16,42,16,41,16,41,16,41,19,40,16,49,25,40,15,35,8,15,8,9,8,14,8,11,
                                    16,7,16,9,16,10,16,18,16,27,16,27,16,27,16,27,20,14,16,22,20,27,20,33,20,24,16,18,16,35,16,38,16,37,16,38,16,37,16,38,31,26,53,16,30,26,35,26,46,9,16,49,16,49,12,49,16,34,16,35,16,35,16,29,20,31,20,33,20,31,12,33,12,31,
                                    16,33,17,38,28,25,21,25,23,23,11,10,11,15,11,29,17,31,28,34,33,27,33,16,16,10,18,24,23,24,15,33,32,24,27,18,
                                    16,17,16,17,20,26,20,25,20,20,16,26,16,26,20,26,16,26,12,39,20,38,16,38,20,37,20,37,16,37,7,23,7,39,15,29,29,37,29,29,16,23,20,50,20,54,32,59,32,49,32,55,24,50,24,61,24,48,24,42,
                                    28,52,24,46,36,47,24,52,28,52,12,33,28,61,28,59,28,60,28,60,24,58,15,34,15,35,15,36,15,39,24,45,24,43,20,23,20,40,20,41,24,39,31,51,24,31,7,15,8,15,20,51,24,53,
                                    20,55,20,55,20,56,20,55,20,56,16,39,16,36,16,38,16,38,16,37,16,38,16,38,16,39,16,36,16,54,12,54,16,53,12,54,12,53,20,32,12,32,16,31,12,32,12,31,16,27,20,37,20,38,20,38,16,15,20,49,12,38,12,41,16,37,12,41,8,15,8,16,8,16,
                                    12,21,12,24,12,21,8,21,12,30,8,25,4,9,16,21,
                                    7,101,11,98,48,77,33,59,32,45,40,41,36,55,40,41,17,32,17,29,19,32,19,34,17,33,16,32,16,29,16,30,20,30,20,31,8,10,12,14,12,19,12,24,16,26,16,28,20,32,16,33,8,9};

    fprintf(stderr, "anim_enemy = [\n");
    for (i = 0; i < NMI_ANIM_TABLE_COUNT; i++) {
        if( anim_enemy[i] < 0 ) {
            fprintf(stderr, "%hd,\n", anim_enemy[i]);    
        }
        else {
            fprintf(stderr, "%hd, ", anim_enemy[i]);
        }
    }
    fprintf(stderr, "];\n");

    for (i = 0; i < ANIM_PLAYER_COUNT; i++) {
        for (j = 0; j < ANIM_PLAYER_MAX; j++) {
            anim_player[i][j] = orig_anim_player[i][j];
            if (anim_player[i][j] < 0) {
                break;
            }
        }
    }

    if (game == Titus) {
        for (i = 0; i < SPRITECOUNT; i++) {
            spritewidth[i] = spritewidth_titus[i];
            spriteheight[i] = spriteheight_titus[i];
            spritecollwidth[i] = tmpspritecoll_titus[i * 2];
            spritecollheight[i] = tmpspritecoll_titus[(i * 2) + 1];
            spriterefwidth[i] = tmpspriteref_titus[i * 2];
            spriterefheight[i] = tmpspriteref_titus[(i * 2) + 1];
        }
        int16_t anim_player_titus[] =     {2,2,2,1,1,1,1,2,2,2,3,3,3,3,-28};
        for (i = 0; i < ANIM_PLAYER_MAX; i++) {
            anim_player[1][i] = anim_player_titus[i];
        }
    } else if (game == Moktar) {
        for (i = 0; i < SPRITECOUNT; i++) {
            spritewidth[i] = spritewidth_moktar[i];
            spriteheight[i] = spriteheight_moktar[i];
            spritecollwidth[i] = tmpspritecoll_moktar[i * 2];
            spritecollheight[i] = tmpspritecoll_moktar[(i * 2) + 1];
            spriterefwidth[i] = tmpspriteref_moktar[i * 2];
            spriterefheight[i] = tmpspriteref_moktar[(i * 2) + 1];
        }
        #define ANIM_PLAYER_MAX_MOKTAR 12
        int16_t anim_player_moktar[] =    {2,2,2,1,1,1,2,2,3,3,3,-11*2};
        for (i = 0; i < ANIM_PLAYER_MAX_MOKTAR; i++) {
            anim_player[1][i] = anim_player_moktar[i];
        }
    }
}

uint16_t getlevelid(uint16_t levelnumber) {
    uint16_t levelid_titus[] = {1,3,4,5,6,7,8,9,10,11,300,12,13,300,14,300,15,300,300,2};
    uint16_t levelid_moktar[] = {1,3,4,5,6,7,8,9,10,11,300,12,13,300,14,15,16,300,300,2};
    uint16_t i;
    if (game == Titus) {
        for (i = 0; i < 20; i++) {
            if (levelid_titus[i] == levelnumber + 1) {
                return i;
            }
        }
    } else {
        for (i = 0; i < 20; i++) {
            if (levelid_moktar[i] == levelnumber + 1) {
                return i;
            }
        }
    }
    assert(false);
    return 65535;
}
